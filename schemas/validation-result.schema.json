{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://research-system/schemas/validation-result.schema.json",
  "title": "Validation Result",
  "description": "Schema for validation metadata and results",
  "type": "object",
  "required": ["component_id", "current_state", "created_at"],
  "additionalProperties": false,
  "properties": {
    "component_id": {
      "type": "string",
      "pattern": "^[A-Z]+-[0-9]{3}$",
      "description": "ID of the catalog entry being validated"
    },
    "current_state": {
      "type": "string",
      "enum": ["HYPOTHESIS", "DATA_AUDIT", "IS_TESTING", "STATISTICAL", "REGIME", "OOS", "DETERMINATION", "COMPLETED", "FAILED"],
      "description": "Current state in validation pipeline"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time"
    },
    "state_history": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["state", "timestamp", "passed"],
        "properties": {
          "state": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "passed": { "type": "boolean" },
          "details": { "type": "string" },
          "executor": { "type": "string" }
        }
      }
    },
    "locked_parameters": {
      "type": "object",
      "properties": {
        "is_period": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 2,
          "maxItems": 2
        },
        "oos_period": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 2,
          "maxItems": 2
        },
        "parameters": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "data_audit": {
      "type": "object",
      "properties": {
        "passed": { "type": "boolean" },
        "timestamp": { "type": "string", "format": "date-time" },
        "checks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "passed": { "type": "boolean" },
              "details": { "type": "string" }
            }
          }
        }
      }
    },
    "is_results": {
      "type": "object",
      "properties": {
        "backtest_id": { "type": "string" },
        "cagr": { "type": "number" },
        "sharpe": { "type": "number" },
        "alpha": { "type": "number" },
        "max_drawdown": { "type": "number" },
        "win_rate": { "type": "number" },
        "total_trades": { "type": "integer" },
        "profit_loss_ratio": { "type": "number" }
      }
    },
    "oos_results": {
      "type": "object",
      "properties": {
        "backtest_id": { "type": "string" },
        "cagr": { "type": "number" },
        "sharpe": { "type": "number" },
        "alpha": { "type": "number" },
        "max_drawdown": { "type": "number" },
        "win_rate": { "type": "number" },
        "total_trades": { "type": "integer" }
      }
    },
    "statistical_analysis": {
      "type": "object",
      "properties": {
        "n_tests": { "type": "integer" },
        "bonferroni_threshold": { "type": "number" },
        "p_value": { "type": "number" },
        "significant": { "type": "boolean" },
        "effect_size": { "type": "number" }
      }
    },
    "sanity_flags": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "flag": { "type": "string" },
          "message": { "type": "string" },
          "resolved": { "type": "boolean" }
        }
      }
    },
    "determination": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["VALIDATED", "CONDITIONAL", "INVALIDATED", "INCONCLUSIVE"]
        },
        "rationale": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "usage": { "type": "string" },
        "regime": { "type": "string" },
        "concerns": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
